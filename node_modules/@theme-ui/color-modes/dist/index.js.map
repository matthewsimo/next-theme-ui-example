{"version":3,"file":"index.js","sources":["../src/custom-properties.js","../src/index.js"],"sourcesContent":["import { css } from '@theme-ui/css'\n\nconst toVarName = (key) => `--theme-ui-${key}`\nconst toVarValue = (key, value) => `var(${toVarName(key)}, ${value})`\n\nconst join = (...args) => args.filter(Boolean).join('-')\n\nconst numberScales = {\n  fontWeights: true,\n  lineHeights: true,\n}\nconst reservedKeys = {\n  useCustomProperties: true,\n  initialColorModeName: true,\n  initialColorMode: true,\n  useLocalStorage: true,\n}\n\nconst toPixel = (key, value) => {\n  if (typeof value !== 'number') return value\n  if (numberScales[key]) return value\n  return value + 'px'\n}\n\n// convert theme values to custom properties\nexport const toCustomProperties = (obj, parent, themeKey) => {\n  const next = Array.isArray(obj) ? [] : {}\n\n  for (let key in obj) {\n    const value = obj[key]\n    const name = join(parent, key)\n    if (value && typeof value === 'object') {\n      next[key] = toCustomProperties(value, name, key)\n      continue\n    }\n    if (reservedKeys[key]) {\n      next[key] = value\n      continue\n    }\n    const val = toPixel(themeKey || key, value)\n    next[key] = toVarValue(name, val)\n  }\n\n  return next\n}\n\nexport const objectToVars = (parent, obj) => {\n  let vars = {}\n  for (let key in obj) {\n    if (key === 'modes') continue\n    const name = join(parent, key)\n    const value = obj[key]\n    if (value && typeof value === 'object') {\n      vars = {\n        ...vars,\n        ...objectToVars(name, value),\n      }\n    } else {\n      vars[toVarName(name)] = value\n    }\n  }\n  return vars\n}\n\n// create body styles for color modes\nexport const createColorStyles = (theme = {}) => {\n  if (!theme.colors || theme.useBodyStyles === false) return {}\n  if (theme.useCustomProperties === false || !theme.colors.modes) {\n    return css({\n      body: {\n        color: 'text',\n        bg: 'background',\n      },\n    })(theme)\n  }\n  const colors = theme.rawColors || theme.colors\n  const { modes } = colors\n  const styles = objectToVars('colors', colors)\n\n  Object.keys(modes).forEach((mode) => {\n    const key = `&.theme-ui-${mode}`\n    styles[key] = objectToVars('colors', modes[mode])\n  })\n\n  return css({\n    body: {\n      ...styles,\n      color: 'text',\n      bg: 'background',\n    },\n  })(theme)\n}\n","import React from 'react'\nimport { jsx, useThemeUI, merge, Context } from '@theme-ui/core'\nimport { get } from '@theme-ui/css'\nimport { Global, ThemeContext as EmotionContext } from '@emotion/core'\nimport { toCustomProperties, createColorStyles } from './custom-properties'\n\nconst STORAGE_KEY = 'theme-ui-color-mode'\n\nconst storage = {\n  get: (init) => {\n    try {\n      return window.localStorage.getItem(STORAGE_KEY) || init\n    } catch (e) {\n      console.warn(\n        'localStorage is disabled and color mode might not work as expected.',\n        'Please check your Site Settings.',\n        e\n      )\n    }\n  },\n  set: (value) => {\n    try {\n      window.localStorage.setItem(STORAGE_KEY, value)\n    } catch (e) {\n      console.warn(\n        'localStorage is disabled and color mode might not work as expected.',\n        'Please check your Site Settings.',\n        e\n      )\n    }\n  },\n}\n\nconst getMediaQuery = () => {\n  const darkQuery = '(prefers-color-scheme: dark)'\n  const lightQuery = '(prefers-color-scheme: light)'\n  const darkMQL = window.matchMedia ? window.matchMedia(darkQuery) : {}\n  const lightMQL = window.matchMedia ? window.matchMedia(lightQuery) : {}\n  const dark = darkMQL.media === darkQuery && darkMQL.matches\n  if (dark) return 'dark'\n  const light = lightMQL.media === lightQuery && lightMQL.matches\n  if (light) return 'light'\n  return 'default'\n}\n\nconst useColorModeState = (theme = {}) => {\n  const [mode, setMode] = React.useState(\n    theme.initialColorModeName || 'default'\n  )\n\n  // initialize state\n  React.useEffect(() => {\n    const stored = theme.useLocalStorage !== false && storage.get()\n    document.body.classList.remove('theme-ui-' + stored)\n    if (!stored && theme.useColorSchemeMediaQuery) {\n      const query = getMediaQuery()\n      setMode(query)\n      return\n    }\n    if (!stored || stored === mode) return\n    setMode(stored)\n  }, [])\n\n  React.useEffect(() => {\n    if (!mode || theme.useLocalStorage === false) return\n    storage.set(mode)\n  }, [mode])\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (\n      theme.colors &&\n      theme.colors.modes &&\n      Object.keys(theme.colors.modes).indexOf(theme.initialColorModeName) > -1\n    ) {\n      console.warn(\n        'The `initialColorModeName` value should be a unique name' +\n          ' and cannot reference a key in `theme.colors.modes`.'\n      )\n    }\n  }\n\n  return [mode, setMode]\n}\n\nexport const useColorMode = () => {\n  const { colorMode, setColorMode } = useThemeUI()\n\n  if (typeof setColorMode !== 'function') {\n    throw new Error(`[useColorMode] requires the ColorModeProvider component`)\n  }\n\n  return [colorMode, setColorMode]\n}\n\nconst applyColorMode = (theme, mode) => {\n  if (!mode) return theme\n  const modes = get(theme, 'colors.modes', {})\n  return merge.all({}, theme, {\n    colors: get(modes, mode, {}),\n  })\n}\n\nconst BodyStyles = () =>\n  jsx(Global, {\n    styles: (theme) => createColorStyles(theme),\n  })\n\nexport const ColorModeProvider = ({ children }) => {\n  const outer = useThemeUI()\n  const [colorMode, setColorMode] = useColorModeState(outer.theme)\n  const theme = applyColorMode(outer.theme || {}, colorMode)\n  const emotionTheme = { ...theme }\n\n  if (theme.useCustomProperties !== false) {\n    emotionTheme.colors = toCustomProperties(emotionTheme.colors, 'colors')\n  }\n\n  const context = {\n    ...outer,\n    theme,\n    colorMode,\n    setColorMode,\n  }\n\n  return jsx(\n    EmotionContext.Provider,\n    { value: emotionTheme },\n    jsx(\n      Context.Provider,\n      { value: context },\n      jsx(BodyStyles, { key: 'color-mode' }),\n      children\n    )\n  )\n}\n\nconst noflash = `(function() { try {\n  var mode = localStorage.getItem('theme-ui-color-mode');\n  if (!mode) return\n  document.body.classList.add('theme-ui-' + mode);\n} catch (e) {} })();`\n\nexport const InitializeColorMode = () =>\n  jsx('script', {\n    key: 'theme-ui-no-flash',\n    dangerouslySetInnerHTML: {\n      __html: noflash,\n    },\n  })\n"],"names":["const","toVarName","key","toVarValue","value","join","args","filter","Boolean","numberScales","fontWeights","lineHeights","reservedKeys","useCustomProperties","initialColorModeName","initialColorMode","useLocalStorage","toPixel","toCustomProperties","obj","parent","themeKey","next","Array","isArray","let","name","val","objectToVars","vars","createColorStyles","theme","colors","useBodyStyles","modes","css","body","color","bg","rawColors","styles","Object","keys","forEach","mode","STORAGE_KEY","storage","get","init","window","localStorage","getItem","e","console","warn","set","setItem","getMediaQuery","darkQuery","lightQuery","darkMQL","matchMedia","lightMQL","dark","media","matches","light","useColorModeState","React","useState","setMode","useEffect","stored","document","classList","remove","useColorSchemeMediaQuery","query","process","env","NODE_ENV","indexOf","useColorMode","useThemeUI","colorMode","setColorMode","Error","applyColorMode","merge","all","BodyStyles","jsx","Global","ColorModeProvider","outer","emotionTheme","context","EmotionContext","Provider","Context","children","noflash","InitializeColorMode","dangerouslySetInnerHTML","__html"],"mappings":"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"}